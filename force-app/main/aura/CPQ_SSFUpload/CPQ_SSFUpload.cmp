<aura:component controller="CPQ_SSFUploadController" implements="lightning:isUrlAddressable">
    <aura:attribute name="quoteId" type="String"/>
    <aura:attribute name="confgId_CPQTempObj" type="String"/>
    <aura:attribute name="cartId" type="String"/>
    <aura:attribute name="flow" type="String"/>
    <aura:attribute name="showLoadingSpinner" type="boolean" default="false" />
    <aura:attribute name="fileName" type="String" default="No File Selected.." />
    <aura:attribute name="csvData" type="CPQ_QTC_CartServices.ProductData[]"/>
    <aura:attribute name="csvCol" type="List"/>
    <aura:attribute name="csvQuoteData" type="CPQ_QTC_CartServices.QuoteData"/>
    <aura:attribute name="csvQuoteCol" type="List"/>

    <aura:attribute name="columns" type="List"/>
    <aura:attribute name="cartVisible" type="Boolean" default="false"/>
    <aura:attribute name="errMsg" type="String" default="" />
    
    <aura:handler name="init" value="{! this }" action="{! c.init }"/>
    
    <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal_large slds-modal slds-fade-in-open">
        <div class="slds-modal__container">
            <header class="slds-modal__header">
                <lightning:buttonIcon iconName="utility:close" onclick="{! c.closeModel }" alternativeText="close" variant="bare-inverse" class="slds-modal__close"/>
                <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">Upload SSF</h2>
            </header>
            
            <div class="slds-modal__content slds-p-around_medium slds-scrollable" id="modal-content-id-1">
                <aura:if isTrue="{!v.errMsg != ''}">
                	<div class="slds-text-heading_medium slds-align_absolute-center slds-text-color_error">{!v.errMsg} </div>
                </aura:if>
                
                <aura:if isTrue="{!v.showLoadingSpinner}">
                    <lightning:spinner alternativeText="Loading" size="medium" />
                    <aura:set attribute="else">
                        <div class="slds-grid slds-gutters">
                            <div class="slds-col">
                                <span>
                                    <lightning:input aura:id="fileId" onchange="{!c.handleFilesChange}" type="file" name="file" label="Select SSF CSV File" multiple="false"/>
                                    <div class="slds-text-body_small slds-text-color_success">{!v.fileName} </div>
                                </span>
                            </div>
                            <div class="slds-col">
                                <span>
                                    <br/>
                                    <button class="slds-button slds-button_brand" onclick="{!c.doUpload}">Upload &amp; Validate</button>
                                    <aura:if isTrue="{!v.cartVisible}">
                                        <button class="slds-button slds-button_brand"  onclick="{!c.goToCart}">Add To Cart</button>
                                    </aura:if>
                                </span>
                            </div>
                            <div class="slds-col">
                                <span></span>
                            </div>
                        </div>
                    </aura:set>
                </aura:if>
                
                <aura:if isTrue="{!v.csvQuoteData != null}">
                    <br/>
                    <h2 style="font-size:16px;"><b>Quote Data</b></h2>
                    <table class="slds-table slds-table--bordered slds-table--striped">
                        <thead>
                            <tr>
                                <td>#Header</td>
                                <td>resellername</td>			
                                <td>transtype</td>
                                <td>custtype</td>
                                <td>purchaseorder</td>
                            </tr>
                        </thead>
                        <tbody>
                                <tr>
                                    <td>#Header</td>
                                    <td>{!v.csvQuoteData.resellername}</td>
                                    <td>{!v.csvQuoteData.transtype}</td>
                                    <td>{!v.csvQuoteData.custtype}</td>
                                    <td>{!v.csvQuoteData.purchaseorder}</td>
                                </tr>
                        </tbody>
                    </table>
                </aura:if>

                <aura:if isTrue="{!v.csvData != null}">
                    <br/>
                    <h2 style="font-size:16px;"><b>Product Data</b></h2>
                    <table class="slds-table slds-table--bordered slds-table--striped">
                        <thead>
                            <tr>
                                <aura:iteration items="{!v.csvCol}" var="col">
                                    <td><b>{!col}</b></td>
                                </aura:iteration>
                                <td><b>Status</b></td>
                            </tr>
                        </thead>
                        <tbody>
                            <aura:iteration items="{!v.csvData}" var="row">
                                <tr>
                                    <td>#Services</td>
                                    <td>{!row.groupid}</td>
                                    <td>{!row.quantity}</td>
                                    <td>{!row.serviceoi}</td>
                                    <td>{!row.tss_productoi}</td>
                                    <td>{!row.tss_productname}</td>
                                    <td>{!row.servicedesc}</td>
                                    <td>{!row.tss_productOIDescription}</td>
                                    <td>{!row.tss_productManufacturer}</td>
                                    <td>{!row.startDate}</td>
                                    <td>{!row.endDate}</td>
                                    <td>{!row.term}</td>
                                    <td>{!row.tss_unitRate}</td>
                                    <td>{!row.extunitrate}</td>
                                    <td>{!row.tss_oneTimeCharge}</td>
                                    <td>{!row.extonetimecharge}</td>
                                    <td>{!row.unitdisc}</td>
                                    <td>{!row.tss_discUnitRate}</td>
                                    <td>{!row.extdiscunitrate}</td>
                                    <td>{!row.onetimedisc}</td>
                                    <td>{!row.disconetimecharge}</td>
                                    <td>{!row.extdisconetimecharge}</td>
                                    <td>{!row.adjusttype}</td>
                                    <td>{!row.priceclass}</td>
                                    <td class="{!row.status == 'Success' ? 'slds-text-color_success': 'slds-text-color_error'}"><aura:unescapedHtml value="{!row.status}" /></td>
                                </tr>
                            </aura:iteration>
                        </tbody>
                    </table>
                </aura:if>
            </div>
        </div>
    </section>
    <div class="slds-backdrop slds-backdrop_open"></div>
</aura:component>