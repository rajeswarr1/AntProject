<aura:component >
    <!-- Initial Function -->
    <aura:handler name="init" value="{!this}" action="{!c.doInit}"/>
    <aura:handler name="change" value="{!v.options}" action="{!c.doInit}"/>
    <aura:handler name="change" value="{!v.value}" action="{!c.doInit}"/>
    <!-- Global Attributes -->
    <aura:attribute name="class" type="String"/>
    <aura:attribute name="label" type="String"/>
    <aura:attribute name="title" type="String"/>
    <aura:attribute name="placeholder" type="String" default=""/>
    <aura:attribute name="required" type="Boolean" default="false"/>
    <aura:attribute name="disabled" type="Boolean" default="false"/>
    <aura:attribute name="readonly" type="Boolean" default="false"/>
    <aura:attribute name="options" type="List"/>
    <aura:attribute name="value" type="Object" default=""/>
    <!-- Private Attributes -->
    <aura:attribute name="filteredOptions" access="private" type="List"/>
    <aura:attribute name="missing" access="private" type="Boolean" default="false"/>
    <aura:attribute name="selected" access="private" type="Boolean" default="false"/>
    <aura:attribute name="reload" access="private" type="Boolean" default="false"/>
    <!-- Events -->
    <aura:registerEvent name="onchange" type="c:searchSelectEvent"/>
    <!-- Functions -->
    <aura:method name="getSelectedValue" action="{!c.getSelectedValue}" description="Get Selected Value"/>
    <aura:method name="setSelectedValue" action="{!c.setSelectedValue}" description="Set Selected Value">
        <aura:attribute name="value" type="String" default=""/>
	</aura:method>
    <!-- Component -->
    <div class="{! v.class }">
        <div class="slds-form-element slds-size_1-of-1 searchSelect" onkeyup="{!c.searchHandler}">
            <label class="slds-form-element__label">
                <aura:if isTrue="{!v.required}">
                    <abbr class="slds-required" title="required">*</abbr>
                </aura:if>
                {!v.label}
            </label>
            <div class="slds-form-element__control">
                <div class="slds-select_container">
                    <lightning:input aura:id="search" type="search"
                                     title="{!v.title}" oncommit="{!c.searchHandler}"
                                     placeholder="{!v.placeholder}" variant="label-hidden"
                                     readonly="{!v.readonly}" disabled="{!v.disabled}"/>
                </div>
            </div>
            <aura:if isTrue="{! v.reload == false }">
                <div class="select">
                    <aura:iteration items="{!v.filteredOptions}" var="option">
                        <lightning:button class="{!option.visible?'':'slds-hide'}" label="{!option.label}" title="{!option.label}" onclick="{! c.selectHandler }" value="{!option.value}"/>
                    </aura:iteration>
                </div>
            </aura:if>
        </div>
        <aura:if isTrue="{!and(v.required, v.selected == null)}">
            <div class="slds-has-error slds-form-element__help" aria-live="assertive">Complete this field.</div>
        </aura:if>
    </div>
</aura:component>